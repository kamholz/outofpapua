CREATE OR REPLACE VIEW entry_senses AS
SELECT entry.id,
  coalesce(json_agg(
    json_build_object(
      'id', sense.id,
      'pos', sense.pos,
      'note', sense.note,
      'glosses', sense.glosses
    ) ORDER BY sense.seq
  ) FILTER (WHERE sense.id IS NOT NULL), '[]'::json) AS senses
FROM entry
LEFT JOIN sense ON sense.entry_id = entry.id
GROUP BY entry.id
;